<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=夜坂雅><link href=https://shadowrz.github.io/zshdocs-zh/07-redirection/ rel=canonical><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.3.9"><title>第七章：重定向 - Zsh 中文手册</title><link rel=stylesheet href=../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=deep-orange data-md-color-accent=blue> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#_1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=.. title="Zsh 中文手册" class="md-header__button md-logo" aria-label="Zsh 中文手册" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M9.372 86.63c-12.496-12.5-12.496-32.76 0-45.26 12.498-12.49 32.758-12.49 45.258 0L246.6 233.4c12.5 12.5 12.5 32.7 0 45.2l-191.97 192c-12.5 12.5-32.76 12.5-45.258 0-12.496-12.5-12.496-32.7 0-45.2L178.7 256 9.372 86.63zM544 416c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32s14.3-32 32-32h288z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Zsh 中文手册 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 第七章：重定向 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=deep-orange data-md-color-accent=blue aria-label type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=deep-orange data-md-color-accent=blue aria-label type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ShadowRZ/zshdocs-zh title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ShadowRZ/zshdocs-zh </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Zsh 中文手册" class="md-nav__button md-logo" aria-label="Zsh 中文手册" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M9.372 86.63c-12.496-12.5-12.496-32.76 0-45.26 12.498-12.49 32.758-12.49 45.258 0L246.6 233.4c12.5 12.5 12.5 32.7 0 45.2l-191.97 192c-12.5 12.5-32.76 12.5-45.258 0-12.496-12.5-12.496-32.7 0-45.2L178.7 256 9.372 86.63zM544 416c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32s14.3-32 32-32h288z"/></svg> </a> Zsh 中文手册 </label> <div class=md-nav__source> <a href=https://github.com/ShadowRZ/zshdocs-zh title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </div> <div class=md-source__repository> ShadowRZ/zshdocs-zh </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../00-translator-notes/ class=md-nav__link> 译者注释 </a> </li> <li class=md-nav__item> <a href=../01-manual-description/ class=md-nav__link> 第一章：Zsh 手册 </a> </li> <li class=md-nav__item> <a href=../02-introduction/ class=md-nav__link> 第二章：简介 </a> </li> <li class=md-nav__item> <a href=../03-roadmap/ class=md-nav__link> 第三章：路程图 </a> </li> <li class=md-nav__item> <a href=../04-invocation/ class=md-nav__link> 第四章：启动 </a> </li> <li class=md-nav__item> <a href=../05-files/ class=md-nav__link> 第五章：文件 </a> </li> <li class=md-nav__item> <a href=../06-shell-grammer/ class=md-nav__link> 第六章：Shell 语法 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 第七章：重定向 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> 第七章：重定向 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 用参数打开文件描述符 </a> </li> <li class=md-nav__item> <a href=#multios class=md-nav__link> Multios </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 无命令重定向 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../08-command-execution/ class=md-nav__link> 第八章：运行命令 </a> </li> <li class=md-nav__item> <a href=../09-functions/ class=md-nav__link> 第九章：函数 </a> </li> <li class=md-nav__item> <a href=../10-jobs-and-signals/ class=md-nav__link> 第十章：任务控制与信号量 </a> </li> <li class=md-nav__item> <a href=../11-atithmetics/ class=md-nav__link> 第十一章：算术扩展 </a> </li> <li class=md-nav__item> <a href=../12-conditionals/ class=md-nav__link> 第十二章：条件表达式 </a> </li> <li class=md-nav__item> <a href=../13-prompt-expns/ class=md-nav__link> 第十三章：提示符展开 </a> </li> <li class=md-nav__item> <a href=../14-expansions/ class=md-nav__link> 第十四章：展开 </a> </li> <li class=md-nav__item> <a href=../15-parameters/ class=md-nav__link> 第十五章：参数 </a> </li> <li class=md-nav__item> <a href=../16-options/ class=md-nav__link> 第十六章：选项 </a> </li> <li class=md-nav__item> <a href=../17-builtins/ class=md-nav__link> 第十七章：Shell 内建命令 </a> </li> <li class=md-nav__item> <a href=../18-zle-line-editor/ class=md-nav__link> 第十八章：ZLE 行编辑器 </a> </li> <li class=md-nav__item> <a href=../19-completion-widgets/ class=md-nav__link> 第十九章：补全部件 </a> </li> <li class=md-nav__item> <a href=../20-completion-system/ class=md-nav__link> 第二十章：补全系统 </a> </li> <li class=md-nav__item> <a href=../21-compctl-completions/ class=md-nav__link> 第二十一章：基于 `compctl` 的补全系统 </a> </li> <li class=md-nav__item> <a href=../22-zsh-modules/ class=md-nav__link> 第二十二章：Zsh 模块 </a> </li> <li class=md-nav__item> <a href=../23-zcal-calendar/ class=md-nav__link> 第二十三章：日历函数系统 </a> </li> <li class=md-nav__item> <a href=../24-ztcp-tcpsocket/ class=md-nav__link> 第二十四章：TCP 函数系统 </a> </li> <li class=md-nav__item> <a href=../25-zftp-ftpclient/ class=md-nav__link> 第二十五章：Zftp 函数系统 </a> </li> <li class=md-nav__item> <a href=../26-user-contrib/ class=md-nav__link> 第二十六章：用户贡献 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ShadowRZ/zshdocs-zh/edit/master/docs/07-redirection.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=_1>第七章：重定向<a class=headerlink href=#_1 title="Permanent link">&para;</a></h1> <p>如果一个命令后跟着 <code>&amp;</code> 且作业控制不生效，该命令默认的标准输出是空文件 <code>/dev/null</code>。否则，命令的执行环境会包含 Shell 按照输入 / 输出规范修改的文件描述符。</p> <p>以下的规范可出现在简单命令的任何位置或复杂命令前后。<em>word</em> 或 <em>digit</em> 除非下文有注解，在使用前会发生展开，如果 <em>word</em> 的展开结果包含多于一个的文件名，每个文件名都发生重定向。</p> <dl> <dt><code>&lt;</code> word</dt> <dd>以读取模式打开 <em>word</em> 并作为标准输入。用这种方式打开不存在的文件会产生错误。</dd> <dt><code>&lt;&gt;</code> word</dt> <dd>以读写模式打开 <em>word</em> 并作为标准输入。如果文件不存在则创建它。</dd> <dt><code>&gt;</code> word</dt> <dd>以写入模式打开 <em>word</em> 并作为标准输出。如果文件不存在则创建它。如果文件存在，且 <code>CLOBBER</code> 选项未被设定，产生错误；否则文件大小截断为零。</dd> <dt><code>&gt;|</code> word</dt> <dt><code>&gt;!</code> word</dt> <dd>同 <code>&gt;</code>，除了无视 <code>CLOBBER</code> 无条件在文件存在时将文件长度截断为零。</dd> <dt><code>&gt;&gt;</code> word</dt> <dd>以追加模式打开 <em>word</em> 并作为标准输出。如果文件不存在，且 <code>CLOBBER</code> 和 <code>APPEND_CREATE</code> 选项都未被设定，产生错误；否则创建文件。</dd> <dt><code>&gt;&gt;|</code> word</dt> <dt><code>&gt;&gt;!</code> word</dt> <dd>同 <code>&gt;&gt;</code>，除了无视 <code>CLOBBER</code> 和 <code>APPEND_CREATE</code> 无条件在文件不存在时创建文件。</dd> <dt><code>&lt;&lt;</code>[<code>-</code>] word</dt> <dd>Shell 开始读取输入，直到读取到和 <em>word</em> 相同的一行，或直到读取到文件结束符。<em>word</em> 中不会发生参数展开，命令替换或文件名生成。产生的被称为 <em>here-document</em> 的文档作为标准输入。<br> 如果 <em>word</em> 中任何字符被单引号，双引号或者 <code>\</code> 引用（Quoted），文档中的字符不会被解析，否则会发生参数和命令替换，紧随换行的 <code>\</code> 被移除，并且必须用 <code>\</code> 来引用字符 <code>\</code>，<code>$</code>，<code>'</code> 以及 <em>word</em> 的首字符。<br> 注意 <em>word</em> 不会被 Shell 展开。<em>word</em> 中的反引号（<span class="critic comment">`</span>）不会发生作用，而是类似于双引号，除了反引号自身会被原封不动地传入。（该信息仅为完整性而提供，不建议使用反引号。）<code>$'...'</code> 形式的引用会产生展开反斜杠引用为特殊字符的标准效果。<br> 如果使用 <code>&lt;&lt;-</code>，前面的所有 Tab <span class="critic comment">译注：是 Tab 而不是空格！</span>会从 <em>word</em> 和文档中移除。</dd> <dt><code>&lt;&lt;&lt;</code> word</dt> <dd>Shell 展开 <em>word</em> 并把结果作为标准输入。这被称为 <em>here-string</em>。和 Here-Document 中的 <em>word</em> 相比，前者的 <em>word</em> Shell 不展开。产生的结果结尾有换行。</dd> <dt><code>&lt;&amp;</code> number</dt> <dt><code>&gt;&amp;</code> number</dt> <dd>标准输入 / 输出从以 <em>number</em> 表示的文件描述符（数字）复制（见 dup2(2)）。</dd> <dt><code>&lt;&amp; -</code></dt> <dt><code>&gt;&amp; -</code></dt> <dd>关闭标准输入 / 输出。</dd> <dt><code>&lt;&amp; p</code></dt> <dt><code>&gt;&amp; p</code></dt> <dd>从协程的输入 / 到协程的输出移动到标准输入 / 输出。</dd> <dt><code>&gt;&amp;</code> word</dt> <dt><code>&amp;&gt;</code> word</dt> <dd>（除非 <code>&gt;&amp; word</code> 符合上述语法；可使用 <code>&amp;&gt;</code> 避免歧义。）同时将标准输出和标准错误（文件描述符 2）以 <code>&gt; word</code> 的形式重定向。注意 Multios（见下）情况下它 <em>不</em> 产生和 <code>&gt; word 2&gt;&amp;1</code> 一样的效果。</dd> <dt><code>&gt;&amp;|</code> word</dt> <dt><code>&gt;&amp;!</code> word</dt> <dt><code>&amp;&gt;|</code> word</dt> <dt><code>&amp;&gt;!</code> word</dt> <dd>同时将标准输出和标准错误（文件描述符 2）以 <code>&gt;| word</code> 的形式重定向。</dd> <dt><code>&gt;&gt;&amp;</code> word</dt> <dt><code>&amp;&gt;&gt;</code> word</dt> <dd>同时将标准输出和标准错误（文件描述符 2）以 <code>&gt;&gt; word</code> 的形式重定向。</dd> <dt><code>&gt;&gt;&amp;|</code> word</dt> <dt><code>&gt;&gt;&amp;!</code> word</dt> <dt><code>&amp;&gt;&gt;|</code> word</dt> <dt><code>&amp;&gt;&gt;!</code> word</dt> <dd>同时将标准输出和标准错误（文件描述符 2）以 <code>&gt;&gt;| word</code> 的形式重定向。</dd> </dl> <p>如果以上任一语法前有数字，则使用的文件描述符是该数字指定的文件描述符而非默认的 0 或 1。指定重定向的顺序非常重要。Shell 按照（<em>文件描述符</em>，<em>文件</em>）关联的方式处理每个重定向。例如：</p> <div class=highlight><pre><span></span><code>... <span class=m>1</span>&gt;fname <span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
</code></pre></div> <p>首先将文件描述符 1 与 <em>fname</em> 关联。然后将文件描述符 2 与文件描述符 1 关联的文件（<em>fname</em>）关联。若调换重定向顺序，文件描述符 2 将与终端关联（假定文件描述符 1 此时已经如此关联）且文件描述符 1 与文件 <em>fname</em> 关联。</p> <p><a href=../06-shell-grammer/#_1>-&gt; 简单的命令与管道</a> 中描述的分隔符 <code>|&amp;</code> 是 <code>2&gt;&amp;1 |</code> 的简写。</p> <p>进程替换的多种形式，即用于输入的 <code>&lt;(list)</code> 和 <code>=(list)</code> 以及用于输出的 <code>&gt;(list)</code>，常与重定向一起使用。例如，如果输出重定向中的 <em>word</em> 是 <code>&gt;(list)</code> 形式，输出被管道到 <em>list</em> 表示的命令。详见 %%。</p> <h2 id=_2>用参数打开文件描述符<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>当 Shell 将参数解析成命令时，且 Shell 选项 <code>IGNORE_BRACES</code> 未被设置时，可以使用另一种形式的重定向：操作符前可以不是数字而是花括号<span class="critic comment">{}</span>表示的有效 Shell 标识符。Shell 会打开一个新的保证数字至少为 10 的文件描述符并将标识符指向的参数设定为打开的文件描述符。闭合花括号和重定向字符间不能有空格。例如：</p> <div class=highlight><pre><span></span><code>... <span class=o>{</span>myfd<span class=o>}</span>&gt;<span class=p>&amp;</span><span class=m>1</span>
</code></pre></div> <p>这会打开一个新的文件描述符，其是文件描述符 1 的复制，并把参数 <code>myfd</code> 设定成该文件描述符的至少为 10 的数字。可以用 <code>&gt;&amp;$myfd</code> 语法写入新文件描述符。该文件描述符在子 Shell 和产生的外部可执行文件中保持打开状态。</p> <p><code>{varid}&gt;&amp;-</code> 语法，例如 <code>{myfd}&gt;&amp;-</code>，可以用于关闭用这种方法打开的文件描述符。注意这种情况下 <em>varid</em> 指定的参数此前必须设定成文件描述符。</p> <p>参数只读时用这种方法打开或关闭文件描述符会产生错误。然而如果 <em>param</em> 只读，用 <code>&lt;&amp;$</code><em>param</em> 或 <code>&gt;&amp;$</code><em>param</em> 读写文件描述符不产生错误。</p> <p>如果未设定选项 <code>CLOBBER</code>，用一个此前已经通过这种方式设定为打开的文件描述符的参数打开文件描述符会产生错误。在用该参数打开文件描述符前取消设定参数可避免这一错误。</p> <p>注意这种方式只分配或关闭文件描述符；它不会执行任何从它或到它的重定向。使用用于 <code>exec</code> 的文件描述符前分配它通常会很方便。这个语法当用在像括号内子 Shell 或循环这样的复杂命令周围时无论如何都不会工作，因为此时打开的花括号被解析为当前 Shell 里执行的命令列表的一部分。</p> <p>以下展示了一个通常的分配，使用，关闭文件描述符的例子：</p> <div class=highlight><pre><span></span><code>integer myfd
<span class=nb>exec</span> <span class=o>{</span>myfd<span class=o>}</span>&gt;~/logs/mylogfile.txt
print This is a log message. &gt;<span class=p>&amp;</span><span class=nv>$myfd</span>
<span class=nb>exec</span> <span class=o>{</span>myfd<span class=o>}</span>&gt;<span class=p>&amp;</span>-
</code></pre></div> <p>注意表达式 <code>&gt;&amp;$myfd</code> 中变量的展开在重定向打开时发生。这是在命令参数的展开以及此前的重定向被处理之后产生的。</p> <h2 id=multios>Multios<a class=headerlink href=#multios title="Permanent link">&para;</a></h2> <p>如果用户尝试多次打开一个文件描述符用于写入，Shell 会把文件描述符打开为一个像 <em>tee</em> 一样复制输入到所有指定输出的管道，前提是选项 <code>MULTIOS</code> 被设定，而它默认被设定。因此：</p> <div class=highlight><pre><span></span><code>date &gt;foo &gt;bar
</code></pre></div> <p>向两个名为 <code>foo</code> 和 <code>bar</code> 的文件写入日期。注意管道隐含重定向；因此</p> <div class=highlight><pre><span></span><code>date &gt;foo <span class=p>|</span> cat
</code></pre></div> <p>将日期写入到文件 <code>foo</code>，还把它管道到 cat。</p> <p>注意 Shell 打开所有用于 Multio 进程的所有文件，而不是在它们要被写入时。</p> <p>注意重定向永远按顺序展开，这是无视 <code>MULTIOS</code> 设定永远发生的事情，但该选项产生效果时会有额外的影响。例如，表达式 <code>&gt;&amp;1</code> 的含义会在上一个重定向后发生改变：</p> <div class=highlight><pre><span></span><code>date &gt;<span class=p>&amp;</span><span class=m>1</span> &gt;output
</code></pre></div> <p>上一例子中，<code>&gt;&amp;1</code> 在这一行的开头指向标准输出；结果与命令 <code>tee</code> 类似，然而，考虑以下：</p> <div class=highlight><pre><span></span><code>date &gt;output &gt;<span class=p>&amp;</span><span class=m>1</span>
</code></pre></div> <p>由于重定向按顺序执行，当遇到 <code>&gt;&amp;1</code> 时标准输入已经设定为文件 <code>output</code> 从而另一份输出也写入到那个文件。这可能不是预期行为。</p> <p>如果设定 <code>MULTIOS</code>，重定向操作符后的单词还会发生文件名生成（Globbing）。因此</p> <div class=highlight><pre><span></span><code>: &gt; *
</code></pre></div> <p>截断当前目录所有文件，假设至少有一个。（没有选项 <code>MULTIOS</code> 时会产生空文件 <code>*</code>。）类似地，你可以</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=nb>exit</span> <span class=m>0</span> &gt;&gt; *.sh
</code></pre></div> <p>如果用户尝试多次打开一个文件描述符用于读取，Shell 会把文件描述符打开为一个复制所有指定输入到其输出的管道，前提是选项 <code>MULTIOS</code> 被设定。注意所有文件都被立即打开，而不是在它们要被读取时。这与 <code>cat</code> 行为不同，所以如果需要严格的标准行为，应该使用 <code>cat</code>。</p> <p>因此</p> <div class=highlight><pre><span></span><code>sort &lt;foo &lt;fubar
</code></pre></div> <p>甚至</p> <div class=highlight><pre><span></span><code>sort &lt;f<span class=o>{</span>oo,ubar<span class=o>}</span>
</code></pre></div> <p>都与 <code>cat foo fubar | sort</code> 等效。</p> <p>重定向参数的展开发生在重定向打开时，在上述描述的 <code>&gt;&amp;$myfd</code> 中变量展开时。</p> <p>注意管道隐含重定向；因此</p> <div class=highlight><pre><span></span><code>cat bar <span class=p>|</span> sort &lt;foo
</code></pre></div> <p>等效于 <code>cat bar foo | sort</code>（注意输入顺序）。</p> <p>如果 <em>没有</em> 设置 <code>MULTIOS</code> 选项，每个重定向替换先前那个对应文件描述符的重定向。然而所有被重定向到的文件实际上都被打开，所以</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span> Hello &gt; bar &gt; baz
</code></pre></div> <p>在未设置 <code>MULTIOS</code> 时截断 <code>bar</code>，向 <code>baz</code> 写入 <code>Hello</code>。</p> <p>输出 Multio 接入外部程序时有一个问题，一个简单的例子展示了这一点：</p> <div class=highlight><pre><span></span><code>cat file &gt;file1 &gt;file2
cat file1 file2
</code></pre></div> <p>这里，第二个 <code>cat</code> 有可能不能完整输出 <code>file1</code> 和 <code>file2</code> 的内容（即 <code>file</code> 原始内容重复两次）。</p> <p>这种情况发生的原因是 Multios 在 <code>cat</code> 进程从父 Shell 中分叉时产生，所以父 Shell 不等待 Multios 写入完数据。这意味着上述命令可能在 <code>file1</code> 和 <code>file2</code> 完全写入前就退出。为绕过此问题，可以把 <code>cat</code> 进程运行为当前 Shell 的一个作业：</p> <div class=highlight><pre><span></span><code><span class=o>{</span> cat file <span class=o>}</span> &gt;file &gt;file2
</code></pre></div> <p>这里 <code>{...}</code> 作业等待两个文件都写入完毕。</p> <h2 id=_3>无命令重定向<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>如果一个简单命令包含一个或多个重定向操作符以及零或多个参数赋值，但没有命令名，Zsh 有多种表现行为。</p> <p>如果未设定参数 <code>NULLCMD</code> 或选项 <code>CSH_NULLCMD</code> 被设定，产生错误。这是 <em>csh</em> 默认行为且模拟 <em>csh</em> 时 <code>CSH_NULLCMD</code> 被默认设定。</p> <p>如果设定选项 <code>SH_NULLCMD</code>，内建命令 <code>:</code> 被插入为命令，继承给定重定向。这是模拟 <em>sh</em> 或 <em>ksh</em> 默认行为。</p> <p>否则，如果设定参数 <code>NULLCMD</code>，它的值作为命令，继承给定重定向。如果同时设定 <code>NULLCMD</code> 和 <code>READNULLCMD</code>，如果重定向是输入则使用后者而非前者。<code>NULLCMD</code> 默认是 <code>cat</code> 而 <code>READNULLCMD</code> 默认是 <code>more</code>。因此</p> <div class=highlight><pre><span></span><code>&lt; file
</code></pre></div> <p>在标准输出上显示 <code>file</code> 内容，在终端时带分页。<code>NULLCMD</code> 和 <code>READNULLCMD</code> 可指向 Shell 函数。</p> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2022-07-29 14:22:24</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../06-shell-grammer/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 第六章：Shell 语法" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> 第六章：Shell 语法 </div> </div> </a> <a href=../08-command-execution/ class="md-footer__link md-footer__link--next" aria-label="下一页: 第八章：运行命令" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> 第八章：运行命令 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> 2020-2022 夜坂雅及<a href=https://github.com/ShadowRZ/zshdocs-zh/graphs/contributors>其他贡献者</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["toc.integrate"], "search": "../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../assets/javascripts/bundle.6c7ad80a.min.js></script> </body> </html>